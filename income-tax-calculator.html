<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>One.Finance's Income Tax Calculator</title>
    <link
        rel="icon"
        href="icon.png"
        type="image/png"
    />
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
    />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        /* --- CSS Variables for consistent branding --- */
        :root {
            --primary-color: #1A8917; /* One.Finance Green */
            --primary-dark: #167A14;
            --accent-color: #26C281; /* A brighter green for highlights */
            --text-dark: #333333;
            --text-light: #666666;
            --bg-light: #f5f8fa; /* Lighter background */
            --bg-white: #FFFFFF;
            --border-color: #e0e0e0;
            --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 8px 24px rgba(0, 0, 0, 0.1);
            --font-family: 'Inter', sans-serif;
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --error: #e74c3c;
            --guideline-bg: #e6f7ff; /* Light blue for guidelines */
            --guideline-color: #0056b3; /* Darker blue for guideline text */
        }

        /* --- Base Styles --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--bg-light);
            -webkit-font-smoothing: antialiased;
            scroll-behavior: smooth;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        a {
            text-decoration: none;
            color: var(--primary-color);
            transition: color 0.3s ease;
        }

        a:hover {
            color: var(--primary-dark);
        }

        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            color: var(--text-dark); /* Default for light backgrounds */
            margin-bottom: 0.8em;
        }
        /* Specific overrides for calculator headings */
        .wizard h1, .wizard h2 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 20px;
        }


        h1 { font-size: 3.2em; line-height: 1.1; }
        h2 { font-size: 2.5em; }
        h3 { font-size: 1.8em; }
        p { margin-bottom: 1em; color: var(--text-light); }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        .btn {
            display: inline-block;
            padding: 0.9rem 2.2rem;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
            cursor: pointer;
            border: none;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--bg-white);
            box-shadow: var(--shadow-light);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .btn-outline {
            background-color: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-color);
            color: var(--bg-white);
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        /* --- Header --- */
        .header {
            background-color: var(--bg-white);
            padding: 0.7rem 0;
            box-shadow: var(--shadow-light);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8em;
            font-weight: 800;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }

        .logo img {
            height: 38px; /* Adjust as needed */
            margin-right: 10px;
            border-radius: 5px;
        }

        .nav-menu {
            list-style: none;
            display: flex;
            gap: 1.4rem;
        }

        .nav-menu a {
            color: var(--text-dark);
            font-weight: 500;
            font-size: 1.05em;
            padding: 0.5rem 0;
            position: relative;
        }

        .nav-menu a::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary-color);
            transition: width 0.3s ease;
        }

        .nav-menu a:hover::after {
            width: 100%;
        }

        /* Dropdown Menu for Services and Tools */
        .dropdown {
            position: relative;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            background-color: var(--bg-white);
            box-shadow: var(--shadow-light);
            list-style: none;
            min-width: 200px;
            z-index: 10;
            border-radius: var(--border-radius-sm);
            padding: 0.4rem 0;
            top: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
        }

        .dropdown:hover .dropdown-menu {
            display: block;
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        .dropdown-menu li a {
            padding: 8px 18px;
            display: block;
            white-space: nowrap;
            font-size: 0.95em;
            color: var(--text-dark); /* Dropdown links are dark on white background */
        }

        .dropdown-menu li a:hover {
            background-color: var(--bg-light);
            color: var(--primary-color);
        }

        /* Mobile Menu */
        .menu-toggle {
            display: none;
            font-size: 1.8em;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-dark);
        }

        /* --- Calculator Specific Styles --- */
        .main-content-area {
            flex-grow: 1; /* Allows content to take available space */
            padding: 2.5rem 0; /* Padding for the main content area */
        }

        .main-container-calculator {
            display: grid;
            grid-template-columns: 1fr 300px; /* Calculator on left, CTA on right */
            gap: 2rem;
            max-width: 1200px; /* Wider max-width for the overall layout */
            margin: 0 auto; /* Centered within main-content-area */
            padding: 0 1.5rem; /* Horizontal padding for smaller screens */
        }

        .wizard {
            padding: 2.5rem; /* More padding */
            background: var(--bg-white);
            border-radius: 12px; /* Softer corners */
            box-shadow: var(--shadow-medium);
            position: relative;
        }

        .cta-form-container {
            background: var(--bg-white);
            border-radius: 12px;
            box-shadow: var(--shadow-medium);
            padding: 1.5rem;
            align-self: start; /* Align to the start of the grid cell */
            /* Initial state for animation */
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .cta-form-container.animate-in {
            opacity: 1;
            transform: translateY(0);
        }

        .cta-form-container h3 {
            font-size: 1.4rem;
            margin-bottom: 1.2rem;
            color: var(--primary-color);
            text-align: center;
        }

        .cta-form-container .form-field {
            margin-bottom: 1rem;
        }

        .cta-form-container label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        .cta-form-container input[type="text"],
        .cta-form-container input[type="email"],
        .cta-form-container input[type="tel"],
        .cta-form-container select,
        .cta-form-container textarea { /* Added textarea for consistency */
            width: 100%;
            padding: 0.7rem 1rem; /* Slightly smaller padding than main inputs */
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: var(--font-family);
            font-size: 0.95rem;
            color: var(--text-dark);
        }

        .cta-form-container input:focus,
        .cta-form-container select:focus,
        .cta-form-container textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 137, 23, 0.15);
        }

        .cta-form-container button {
            width: 100%;
            padding: 0.8rem 1.5rem;
            background: var(--primary-color);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.1s ease;
            margin-top: 1rem;
        }

        .cta-form-container button:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .wizard .logo { /* Specific styling for logo within calculator */
            display: block;
            margin: 0 auto 1.5rem;
            height: 70px;
            object-fit: contain;
        }

        /* Progress Bar */
        #progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3rem;
            position: relative;
        }

        .step-indicator {
            position: relative;
            flex: 1;
            text-align: center;
            cursor: pointer;
            padding-top: 2.2rem;
            font-size: 0.9em;
            color: #888;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        .step-indicator:hover {
            color: var(--text-dark);
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 18px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--border-color);
            z-index: -1;
        }

        .step-indicator:first-child::before {
            left: 50%;
            width: 50%;
        }

        .step-indicator:last-child::before {
            width: 50%;
            left: 0;
        }

        .step-indicator .circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--border-color);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #fff;
            transition: background 0.3s ease, color 0.3s ease;
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            border: 2px solid transparent;
        }
        .step-indicator.active .circle {
            background: var(--primary-color);
            border-color: var(--primary-dark);
            box-shadow: 0 0 0 4px rgba(26, 137, 23, 0.2);
        }
        .step-indicator.completed .circle {
            background: var(--accent-color);
            color: #fff;
        }
        .step-indicator.active {
            color: var(--primary-color);
        }
        .step-indicator span {
            display: block;
            margin-top: 0.7rem;
        }

        /* Step content */
        .step {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
            min-height: 350px;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .wizard h2 {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
            text-align: center;
        }

        .fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        /* Input Field Container for Guideline */
        .field-container {
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 0.6rem;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        input,
        select {
            width: 100%;
            padding: 0.8rem 1.2rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            font-family: var(--font-family);
            font-size: 1rem;
            color: var(--text-dark);
        }

        input::placeholder {
            color: #a0a0a0;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(26, 137, 23, 0.2);
        }

        /* Readonly inputs */
        input[readonly] {
            background-color: #f0f0f0;
            cursor: not-allowed;
            color: #666;
        }

        /* Guideline box - Reduced Size */
        .guideline {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--guideline-bg);
            color: var(--guideline-color);
            padding: 0.5rem 0.8rem; /* Reduced padding */
            border-radius: 6px;
            font-size: 0.8rem; /* Smaller font size */
            margin-top: 0.4rem; /* Reduced margin */
            box-shadow: var(--shadow-light);
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transform: translateY(5px); /* Less vertical shift */
            transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s ease;
        }

        .guideline.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }


        .section-separator {
            margin: 2.5rem 0;
            border-bottom: 1px dashed #ddd;
        }

        .error {
            color: var(--error);
            font-size: 0.85rem;
            margin-top: 0.5rem;
            min-height: 1.2em;
            font-weight: 500;
        }

        /* Buttons */
        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2.5rem;
            gap: 1rem;
            flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
        }

        .buttons button {
            padding: 0.9rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.05rem;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.1s ease;
            font-weight: 600;
            flex-grow: 1;
            min-width: 120px;
        }

        .next-btn {
            background: var(--primary-color);
            color: #fff;
        }

        .next-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        .prev-btn {
            background: #999;
            color: #fff;
        }

        .prev-btn:hover {
            background: #777;
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        .reset-btn {
            background: #3498db;
            color: #fff;
        }

        .reset-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        #downloadBtn {
            background: #34495e;
            color: #fff;
        }

        #downloadBtn:hover {
            background: #2c3e50;
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        /* Summary sections (Step 2, 5, 6) */
        .summary-section {
            background-color: #f0f9f4;
            border-left: 5px solid var(--primary-color);
            padding: 1.2rem 1.5rem;
            border-radius: 8px;
            margin-top: 1.5rem;
            box-shadow: var(--shadow-light);
        }
        .summary-section p {
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-dark); /* Ensure text is readable */
        }
        .summary-section p:last-child {
            margin-bottom: 0;
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--primary-dark);
        }
        .summary-section strong {
            font-weight: 700;
            color: var(--text-dark);
            font-size: 1.05rem;
        }

        /* Result Table */
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.8rem;
            font-size: 0.95rem;
        }

        .result-table th,
        .result-table td {
            padding: 1rem 0.8rem;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .result-table th {
            background: var(--primary-color);
            color: #fff;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .result-table tbody tr:nth-child(odd) {
            background: #f9fdfb;
        }

        .result-table tbody tr:nth-child(even) {
            background: #eef8f3;
        }

        .result-table tr.bold-row td {
            font-weight: 700;
            background-color: #e0f0ea !important;
            color: var(--primary-dark);
        }

        /* Thank you message */
        .thankyou {
            margin-top: 2rem;
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
            text-align: center;
        }

        .thankyou a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s ease;
        }

        .thankyou a:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        /* --- Footer --- */
        .footer {
            background-color: var(--text-dark); /* Footer remains dark */
            color: var(--bg-white);
            padding: 2rem 0;
            font-size: 0.8em;
            margin-top: auto; /* Pushes footer to the bottom */
        }

        .footer .container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .footer-col {
            flex: 1;
            min-width: 160px;
        }

        .footer-col h4 {
            color: var(--bg-white); /* Changed to white */
            margin-bottom: 0.7rem;
            font-size: 1em;
        }

        .footer-col p, .footer-col a {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.3rem;
            display: block;
        }

        .footer-col a:hover {
            color: var(--bg-white);
        }

        .social-links {
            margin-top: 0.7rem;
        }

        .social-links a {
            display: inline-block;
            color: var(--bg-white);
            font-size: 1.3em;
            margin-right: 0.7rem;
            transition: transform 0.2s ease;
        }

        .social-links a:hover {
            color: var(--primary-color); /* Changed to green */
            transform: translateY(-3px);
        }

        .footer-bottom {
            text-align: center;
            margin-top: 1.5rem;
            padding-top: 1.2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
        }

        /* Print styles */
        @media print {
            body {
                background: #fff !important;
            }
            .main-container-calculator {
                grid-template-columns: 1fr; /* Force single column for print */
                margin: 0;
                padding: 0;
                max-width: none;
            }
            .wizard, .cta-form-container {
                box-shadow: none;
                padding: 0;
                border-radius: 0;
            }
            button,
            #progress,
            input,
            select,
            .buttons,
            .guideline,
            .cta-form-container, /* Hide CTA form on print */
            .header, /* Hide header on print */
            .footer /* Hide footer on print */
            {
                display: none !important;
            }
            .wizard .logo { /* Specific styling for logo within calculator */
                display: block;
                margin: 1rem auto;
                height: 80px;
            }
            .result-table th {
                background: #f0f0f0 !important;
                color: #333 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .result-table tbody tr:nth-child(odd) {
                background: #ffffff !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .result-table tbody tr:nth-child(even) {
                background: #f8f8f8 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .result-table tr.bold-row td {
                background-color: #e8e8e8 !important;
                color: #000 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .thankyou {
                color: #000;
            }
        }

        /* Responsive adjustments */
        @media (max-width: 992px) { /* Tablet and smaller desktops */
            .main-container-calculator {
                grid-template-columns: 1fr; /* Stack columns */
                padding: 0 1rem;
            }
            .wizard {
                padding: 1.5rem;
            }
            .cta-form-container {
                margin-top: 2rem; /* Add some space when stacked */
                padding: 1.5rem;
            }
            .wizard h2 {
                font-size: 1.6rem; /* Slightly smaller headings */
            }
            .fields {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Allow more flexible column sizing */
                gap: 1rem; /* Reduced gap */
            }
            /* START FAQ SECTION ADDITION: Responsive adjustments for FAQ section */
            .faq-section-container {
                padding: 2rem 1rem; /* Adjust padding */
            }
            /* END FAQ SECTION ADDITION */
        }

        @media (max-width: 768px) { /* Smaller tablets and large phones */
            .wizard {
                margin: 1rem; /* Adjust outer margin */
                padding: 1.2rem; /* Reduce padding further */
            }
            .wizard h2 {
                font-size: 1.4rem;
            }
            label {
                font-size: 0.9rem; /* Smaller labels */
            }
            input, select {
                padding: 0.7rem 1rem; /* Smaller input padding */
                font-size: 0.9rem;
            }
            .fields {
                grid-template-columns: 1fr; /* Single column layout for inputs */
            }
            .buttons button {
                flex-grow: 1;
                width: 100%;
                margin-bottom: 0.5rem;
                padding: 0.8rem 1.5rem; /* Smaller button padding */
                font-size: 1rem;
            }
            .buttons {
                flex-direction: column; /* Stack buttons */
            }
            .step-indicator {
                font-size: 0.75em; /* Smaller font for step indicators */
                padding-top: 1.8rem; /* Adjust padding due to smaller circle */
            }
            .step-indicator span {
                margin-top: 0.4rem;
            }
            .step-indicator .circle {
                width: 36px; /* Smaller circle */
                height: 36px;
                font-size: 0.9em;
                top: 0;
            }
            .step-indicator::before {
                top: 16px; /* Adjust line position */
            }
            .summary-section, .result-table {
                font-size: 0.9rem; /* Smaller text in summary/table */
            }
            /* Mobile menu specific styles */
            .header .nav-menu {
                display: none; /* Hide desktop menu */
                flex-direction: column;
                width: 100%;
                background-color: var(--bg-white);
                position: absolute;
                top: 70px; /* Below header */
                left: 0;
                padding: 1rem 0;
                box-shadow: var(--shadow-light);
            }
            .header .nav-menu.active {
                display: flex; /* Show active mobile menu */
            }
            .header .nav-menu li {
                text-align: center;
                margin: 0.5rem 0;
            }
            .menu-toggle {
                display: block; /* Show hamburger icon */
            }
        }

        @media (max-width: 480px) { /* Mobile phones */
            .main-container-calculator {
                margin: 1rem auto;
                padding: 0 0.8rem;
            }
            .wizard {
                padding: 1rem;
            }
            .wizard h2 {
                font-size: 1.2rem; /* Even smaller headings */
                margin-bottom: 1rem;
            }
            .wizard .logo {
                height: 60px;
                margin-bottom: 1rem;
            }
            .step-indicator {
                font-size: 0.65em;
                padding-top: 1.6rem;
            }
            .step-indicator .circle {
                width: 30px;
                height: 30px;
                font-size: 0.8em;
            }
            .step-indicator::before {
                top: 14px;
            }
            .buttons {
                margin-top: 1.5rem;
            }
            .cta-form-container {
                padding: 1rem;
            }
            .cta-form-container h3 {
                font-size: 1.2rem;
            }
            .cta-form-container label {
                font-size: 0.85rem;
            }
            .cta-form-container input, .cta-form-container select, .cta-form-container button {
                font-size: 0.9rem;
                padding: 0.6rem 0.8rem;
            }
        }

        /* START FAQ SECTION ADDITION: Custom styles for the FAQ section */
        .faq-section-container { /* New container for the FAQ section */
            width: 100%;
            padding: 3rem 1.5rem; /* Consistent padding with main-content-area */
            background-color: var(--bg-light); /* Match body background */
        }

        .faq-section-inner { /* Inner container for max-width and centering */
            max-width: 1200px; /* Match main container width */
            margin: 0 auto;
            background-color: var(--bg-white);
            padding: 2.5rem; /* Consistent padding with wizard */
            border-radius: 12px;
            box-shadow: var(--shadow-medium);
        }

        /* Style for the custom arrow/indicator */
        details summary::-webkit-details-marker {
            display: none;
        }

        details summary::after {
            content: '+'; /* Plus sign for closed state */
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color); /* Use primary color */
            transition: transform 0.2s ease-in-out;
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
        }

        details[open] summary::after {
            content: '-'; /* Minus sign for open state */
            transform: translateY(-50%) rotate(0deg); /* No rotation needed for +/- */
        }

        /* Tailwind-like classes for details/summary, adapted to variables */
        .faq-item-details {
            margin-bottom: 1rem; /* mb-4 in Tailwind */
            border-radius: 0.5rem; /* rounded-lg in Tailwind */
            overflow: hidden;
            border: 1px solid var(--border-color); /* border border-gray-300 */
            box-shadow: var(--shadow-light); /* shadow-sm */
            transition: all 0.3s ease;
        }

        .faq-item-details:hover {
            box-shadow: var(--shadow-medium); /* hover:shadow-md */
        }

        .faq-summary {
            display: flex; /* flex items-center justify-between */
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem; /* p-5 */
            cursor: pointer;
            background-color: #f0f9f4; /* bg-indigo-50, adapted to a lighter green tone */
            transition: background-color 0.2s ease;
            position: relative;
        }

        .faq-summary:hover {
            background-color: #e6f7ef; /* hover:bg-indigo-100, adapted */
        }

        .faq-question-text {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            color: var(--text-dark); /* text-gray-800 */
            padding-right: 2rem; /* To make space for the +/- icon */
        }

        .faq-answer-content {
            padding: 1.25rem; /* px-5 pb-5 pt-2 */
            padding-top: 0.5rem;
            color: var(--text-light); /* text-gray-700 */
            background-color: var(--bg-white);
            border-top: 1px solid var(--border-color); /* border-t border-gray-200 */
        }
        /* END FAQ SECTION ADDITION */
    </style>    
</head>
<body>
    <!-- Header Section -->
    <header class="header" id="home">
        <div class="container">
            <a href="index.html" class="logo">
                <img src="logo.png" alt="One.Finance Logo">
            </a>
            <nav>
                <button class="menu-toggle" aria-label="Toggle navigation menu">
                    <i class="fas fa-bars"></i>
                </button>
                <ul class="nav-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About Us</a></li>
                    <li class="dropdown">
                        <a href="#" onclick="return false;">Services <i class="fas fa-caret-down"></i></a>
                        <ul class="dropdown-menu">
                            <li><a href="cfo-service.html">CFO Service</a></li>
                            <li><a href="income-tax.html">Income Tax Consultation</a></li>
                            <li><a href="gst-filing.html">GST Filing & Registration</a></li>
                            <li><a href="other-service.html">Other Service</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" onclick="return false;">Tools <i class="fas fa-caret-down"></i></a>
                        <ul class="dropdown-menu">
                            <li><a href="income-tax-calculator.html">Income Tax Calculator</a></li>
                            <li><a href="invoice-generator.html">Invoice Generator</a></li>
                            <li><a href="rental-agreement-generator.html">Rental Agreement Generator</a></li>
                            <li><a href="#" onclick="return false;">Loan Prepayment Planner (Coming Soon)</a></li>
                            <li><a href="https://chatgpt.com/g/g-687578e125e08191afa13170e0f5d91f-one-finance-ai" target="_blank">One.finance AI</a></li>
                        </ul>
                    </li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="#cta-form">Talk to us</a></li> <!-- Changed text and linked to CTA -->
                </ul>
            </nav>
        </div>
    </header>

    <main class="main-content-area">
        <div class="main-container-calculator">
            <div class="wizard">
                <img src="logo.png" class="logo" alt="One.Finance Logo" />
                <div id="progress">
                    <div class="step-indicator active" data-step="1">
                        <div class="circle">1</div>
                        <span>Basic Info</span>
                    </div>
                    <div class="step-indicator" data-step="2">
                        <div class="circle">2</div>
                        <span>Salary</span>
                    </div>
                    <div class="step-indicator" data-step="3">
                        <div class="circle">3</div>
                        <span>House Prop.</span>
                    </div>
                    <div class="step-indicator" data-step="4">
                        <div class="circle">4</div>
                        <span>Other Income</span>
                    </div>
                    <div class="step-indicator" data-step="5">
                        <div class="circle">5</div>
                        <span>Chapter VI-A</span>
                    </div>
                    <div class="step-indicator" data-step="6">
                        <div class="circle">6</div>
                        <span>80D</span>
                    </div>
                    <div class="step-indicator" data-step="7">
                        <div class="circle">7</div>
                        <span>Review</span>
                    </div>
                </div>

                <div id="step1" class="step active">
                    <h2>Basic Information</h2>
                    <div class="fields">
                        <div class="field-container">
                            <label for="name">Name</label>
                            <input id="name" type="text" maxlength="30" placeholder="Enter your name" data-guideline="Your full name as per PAN record (max 30 characters)." />
                            <div class="error" id="nameError"></div>
                            <div class="guideline" id="guideline-name"></div>
                        </div>
                        <div class="field-container">
                            <label for="fy">Financial Year</label>
                            <select id="fy" data-guideline="The financial year for which you are calculating tax.">
                                <option value="2024-2025">2024-2025</option>
                                <option value="2025-2026">2025-2026</option>

                            </select>
                            <div class="guideline" id="guideline-fy"></div>
                        </div>
                        <div class="field-container">
                            <label for="ay">Assessment Year</label>
                            <input id="ay" type="text" readonly data-guideline="This is automatically determined based on the Financial Year." />
                            <div class="guideline" id="guideline-ay"></div>
                        </div>
                        <div class="field-container">
                            <label for="ageGroup">Age Group</label>
                            <select id="ageGroup" data-guideline="Select your age group as of the financial year end. This affects tax slabs.">
                                <option value="below60">Below 60</option>
                                <option value="above60">Above 60</option>
                            </select>
                            <div class="guideline" id="guideline-ageGroup"></div>
                        </div>
                    </div>
                    <div class="buttons">
                        <button class="next-btn" data-next="step2">Start <i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>

                <div id="step2" class="step">
                    <h2>Income from Salary</h2>
                    <div class="fields">
                        <div class="field-container">
                            <label for="grossSalary">Gross Salary</label>
                            <input id="grossSalary" type="number" min="0" placeholder="e.g., 500000" data-guideline="Enter your total gross salary, including all allowances and perquisites." />
                            <div class="guideline" id="guideline-grossSalary"></div>
                        </div>
                        <div class="field-container">
                            <label for="professionalTax">Professional Tax</label>
                            <input id="professionalTax" type="number" min="0" placeholder="e.g., 2500" data-guideline="Professional tax paid during the financial year (max ₹30,000)." />
                            <div class="guideline" id="guideline-professionalTax"></div>
                        </div>
                        <div class="field-container">
                            <label for="hraExempt">HRA Exempt</label>
                            <input id="hraExempt" type="text" readonly data-guideline="The calculated HRA exemption based on your inputs below." />
                            <div class="guideline" id="guideline-hraExempt"></div>
                        </div>
                        <div class="field-container">
                            <label for="otherExempt">Other Exempted Allowance</label>
                            <input id="otherExempt" type="number" min="0" placeholder="e.g., 10000" data-guideline="Exempt allowances like conveyance, medical, children's education allowance, etc." />
                            <div class="guideline" id="guideline-otherExempt"></div>
                        </div>
                    </div>
                    <div class="error" id="step2Error"></div>
                    <div class="section-separator"></div>
                    <h2>HRA Calculation</h2>
                    <div class="fields">
                        <div class="field-container">
                            <label for="basicPay">Basic Pay</label>
                            <input id="basicPay" type="number" min="0" placeholder="e.g., 200000" data-guideline="Enter your basic salary component for HRA calculation." />
                            <div class="guideline" id="guideline-basicPay"></div>
                        </div>
                        <div class="field-container">
                            <label for="hraReceived">HRA Received</label>
                            <input id="hraReceived" type="number" min="0" placeholder="e.g., 80000" data-guideline="Total HRA received from your employer." />
                            <div class="guideline" id="guideline-hraReceived"></div>
                        </div>
                        <div class="field-container">
                            <label for="rentPaid">Rent Paid</label>
                            <input id="rentPaid" type="number" min="0" placeholder="e.g., 90000" data-guideline="Actual rent paid during the financial year." />
                            <div class="guideline" id="guideline-rentPaid"></div>
                        </div>
                    </div>
                    <div class="summary-section">
                        <p>Gross Salary: <strong id="sumGrossSalary">Rs. 0</strong></p>
                        <p>Total Exemptions: <strong id="sumTotalExemptions">Rs. 0</strong></p>
                    </div>
                    <div class="buttons">
                        <button class="prev-btn" data-prev="step1"><i class="fas fa-arrow-left"></i> Back</button>
                        <button class="next-btn" data-next="step3">Next <i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>

                <div id="step3" class="step">
                    <h2>Income from House Property</h2>
                    <div class="fields">
                        <div class="field-container">
                            <label for="rentReceived">Rent Received</label>
                            <input id="rentReceived" type="number" min="0" placeholder="e.g., 120000" data-guideline="Gross annual rent received if property is let out. Enter 0 if self-occupied." />
                            <div class="guideline" id="guideline-rentReceived"></div>
                        </div>
                        <div class="field-container">
                            <label for="municipalTax">Municipal Tax Paid</label>
                            <input id="municipalTax" type="number" min="0" placeholder="e.g., 5000" data-guideline="Municipal taxes paid for the property during the year." />
                            <div class="guideline" id="guideline-municipalTax"></div>
                        </div>
                        <div class="field-container">
                            <label for="interestLoan">Interest on Loan</label>
                            <input id="interestLoan" type="number" min="0" placeholder="e.g., 150000" data-guideline="Interest paid on housing loan (for purchase, construction, repair). Max ₹2 Lakh for self-occupied." />
                            <div class="guideline" id="guideline-interestLoan"></div>
                        </div>
                        <div class="field-container">
                            <label>Net House Property Income</label>
                            <strong id="sumHHP">Rs. 0</strong>
                            <div class="guideline" id="guideline-sumHHP">Calculated income/loss from house property. Max loss is ₹2 Lakh for old regime.</div>
                        </div>
                    </div>
                    <div class="buttons">
                        <button class="prev-btn" data-prev="step2"><i class="fas fa-arrow-left"></i> Back</button>
                        <button class="next-btn" data-next="step4">Next <i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>

                <div id="step4" class="step">
                    <h2>Income from Other Sources</h2>
                    <div class="fields">
                        <div class="field-container">
                            <label for="savingsIncome">Savings Interest</label>
                            <input id="savingsIncome" type="number" min="0" placeholder="e.g., 8000" data-guideline="Interest earned from savings accounts. Deductible under 80TTA/80TTB." />
                            <div class="guideline" id="guideline-savingsIncome"></div>
                        </div>
                        <div class="field-container">
                            <label for="fdIncome">FD Interest</label>
                            <input id="fdIncome" type="number" min="0" placeholder="e.g., 20000" data-guideline="Interest earned from Fixed Deposits. Fully taxable." />
                            <div class="guideline" id="guideline-fdIncome"></div>
                        </div>
                        <div class="field-container">
                            <label for="dividendIncome">Dividend Received</label>
                            <input id="dividendIncome" type="number" min="0" placeholder="e.g., 5000" data-guideline="Dividends received from shares or mutual funds. Fully taxable." />
                            <div class="guideline" id="guideline-dividendIncome"></div>
                        </div>
                        <div class="field-container">
                            <label>Total Other Income</label>
                            <strong id="sumOtherIncome">Rs. 0</strong>
                            <div class="guideline" id="guideline-sumOtherIncome">Sum of all incomes from other sources.</div>
                        </div>
                    </div>
                    <div class="buttons">
                        <button class="prev-btn" data-prev="step3"><i class="fas fa-arrow-left"></i> Back</button>
                        <button class="next-btn" data-next="step5">Next <i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>

                <div id="step5" class="step">
                    <h2>Chapter VI-A Deductions</h2>
                    <div class="fields">
                        <div class="field-container">
                            <label for="ded80C">80C (₹1.5 Lakh max)</label>
                            <input id="ded80C" type="number" min="0" placeholder="e.g., 150000" data-guideline="Investments like PPF, ELSS, EPF, Life Insurance Premiums, Home Loan Principal. Max ₹1.5 Lakh." />
                            <div class="guideline" id="guideline-ded80C"></div>
                        </div>
                        <div class="field-container">
                            <label for="ded80CCD">80CCD(1B) (≤₹50k NPS)</label>
                            <input id="ded80CCD" type="number" min="0" placeholder="e.g., 50000" data-guideline="Additional NPS contribution by employee (over 80C limit). Max ₹50,000." />
                            <div class="guideline" id="guideline-ded80CCD"></div>
                        </div>
                        <div class="field-container">
                            <label for="ded80CCD2">80CCD(2) (Employer NPS)</label>
                            <input id="ded80CCD2" type="number" min="0" placeholder="e.g., 30000" data-guideline="Employer's contribution to NPS. Max 10% of Basic+DA (private) or 14% (govt)." />
                            <div class="guideline" id="guideline-ded80CCD2"></div>
                        </div>
                        <div class="field-container">
                            <label for="donationPaid">80G (Donation)</label>
                            <input id="donationPaid" type="number" min="0" placeholder="e.g., 10000" data-guideline="Donations to certain funds/institutions. Deduction is 50% or 100% depending on donee." />
                            <div class="guideline" id="guideline-donationPaid"></div>
                        </div>
                    </div>
                    <div class="section-separator"></div>
                    <h2>80TTA / 80TTB Deductions</h2>
                    <div class="fields">
                        <div class="field-container">
                            <label>80TTA (Savings Interest, ≤₹10k)</label>
                            <strong id="ded80TTA">Rs. 0</strong>
                            <div class="guideline" id="guideline-ded80TTA">Deduction on savings bank interest. Max ₹10,000 (for individuals below 60).</div>
                        </div>
                        <div class="field-container">
                            <label>80TTB (Senior Citizen Deposits, ≤₹50k)</label>
                            <strong id="ded80TTB">Rs. 0</strong>
                            <div class="guideline" id="guideline-ded80TTB">Deduction on all deposit interest for senior citizens. Max ₹50,000.</div>
                        </div>
                    </div>
                    <div class="summary-section">
                        <p>Total Chapter VI-A Deductions: <strong id="sumChap6A">Rs. 0</strong></p>
                    </div>
                    <div class="buttons">
                        <button class="prev-btn" data-prev="step4"><i class="fas fa-arrow-left"></i> Back</button>
                        <button class="next-btn" data-next="step6">Next <i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>

                <div id="step6" class="step">
                    <h2>80D Deductions (Medical Insurance)</h2>
                    <div class="fields">
                        <div class="field-container">
                            <label for="premSelf">Premium Self/Family</label>
                            <input id="premSelf" type="number" min="0" placeholder="e.g., 20000" data-guideline="Medical insurance premium for self, spouse, and dependent children (Max ₹25k for below 60, ₹50k for senior citizen)." />
                            <div class="guideline" id="guideline-premSelf"></div>
                        </div>
                        <div class="field-container">
                            <label for="preventiveCheck">Preventive Checkup</label>
                            <input id="preventiveCheck" type="number" min="0" placeholder="e.g., 3000" data-guideline="Expenses for preventive health check-up. Max ₹5,000 (within overall 80D limit)." />
                            <div class="guideline" id="guideline-preventiveCheck"></div>
                        </div>
                        <div class="field-container">
                            <label for="premParent">Parent Insurance</label>
                            <input id="premParent" type="number" min="0" placeholder="e.g., 30000" data-guideline="Medical insurance premium for parents (Max ₹25k for non-senior, ₹50k for senior parents)." />
                            <div class="guideline" id="guideline-premParent"></div>
                        </div>
                        <div class="field-container">
                            <label for="medExpend">Medical Expenditure (Parents)</label>
                            <input id="medExpend" type="number" min="0" placeholder="e.g., 10000" data-guideline="Medical expenses for uninsured senior citizen parents (Max ₹50,000, jointly with premium for parents)." />
                            <div class="guideline" id="guideline-medExpend"></div>
                        </div>
                    </div>
                    <div class="summary-section">
                        <p>Total 80D Deductions: <strong id="sum80D">Rs. 0</strong></p>
                    </div>
                    <div class="buttons">
                        <button class="prev-btn" data-prev="step5"><i class="fas fa-arrow-left"></i> Back</button>
                        <button class="next-btn" data-next="step7">Compute Tax <i class="fas fa-calculator"></i></button>
                    </div>
                </div>

                <div id="step7" class="step">
                    <h2>Review & Compare Your Tax</h2>
                    <div class="review-header">
                        <p><strong>Name:</strong> <span id="reviewName"></span></p>
                        <p><strong>Age Group:</strong> <span id="reviewAge"></span></p>
                        <p><strong>F.Y:</strong> <span id="reviewFY"></span> &nbsp; <strong>A.Y:</strong> <span id="reviewAY"></span></p>
                    </div>
                    <table class="result-table">
                        <thead>
                            <tr>
                                <th>Particulars</th>
                                <th>Old Regime</th>
                                <th>New Regime</th>
                            </tr>
                        </thead>
                        <tbody id="reviewBody"></tbody>
                    </table>
                    <h3>Tax Details</h3>
                    <table class="result-table">
                        <thead>
                            <tr>
                                <th>Component</th>
                                <th>Old Regime</th>
                                <th>New Regime</th>
                            </tr>
                        </thead>
                        <tbody id="taxBreakdownBody"></tbody>
                    </table>
                    <div class="thankyou">
                        <p>Thanks for using One.Finance's Calculator.</p>
                        <p>Need help? <a href="mailto:vishnu@onedotfinance.com">vishnu@onedotfinance.com</a> or call +91 7373772883.</p>
                    </div>
                    <div class="buttons">
                        <button class="reset-btn" onclick="resetAll()"><i class="fas fa-undo"></i> Reset</button>
                        <button id="downloadBtn" onclick="window.print()"><i class="fas fa-download"></i> Download</button>
                        <button class="prev-btn" data-prev="step6"><i class="fas fa-arrow-left"></i> Back</button>
                    </div>
                </div>
            </div>

            <!-- CTA Form Container (from website-revamp-prototype) -->
            <div class="cta-form-container" id="ctaForm">
                <h3>Need Expert Consultation?</h3>
                <div class="form-container">
                <form action="https://formspree.io/f/mkgberpq" method="post">
                    <div class="form-field">
                        <label for="cta-name">Your Name</label>
                        <input type="text" id="cta-name" name="name" required placeholder="Name">
                    </div>
                    <div class="form-field">
                        <label for="cta-email">Email</label>
                        <input type="email" id="cta-email" name="email" required placeholder="Email">
                    </div>
                    <div class="form-field">
                        <label for="cta-phone">Mobile Number</label>
                        <input type="tel" id="cta-phone" name="phone" placeholder="+91 9876543210">
                    </div>
                    <div class="form-field">
                        <label for="cta-service-interest">Service you're looking for</label>
                        <select id="cta-service-interest" name="service_interest">
                            <option value="">-- Select a Service --</option>
                            <option value="Virtual CFO">Virtual CFO Services</option>
                            <option value="Income Tax">Income Tax Consultation</option>
                            <option value="GST">GST Filing & Registration</option>
                            <option value="Other">Company Incorporation</option>                            
                            <option value="Bookkeeping Services">Bookkeeping Services</option>
                            <option value="MIS Reports">MIS Reports</option>
                            <option value="Accounting Advisory">Accounting Advisory</option>
                            <option value="Other">Other Services</option>
                        </select>
                    </div>
                    <div class="form-field">
                        <label for="cta-message">Tell us more about your needs</label>
                        <textarea id="cta-message" name="message" rows="4" placeholder=" "></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Request</button>
                </form>
                <div id="form-message-calc" class="form-message"></div>
                <div class="loading-overlay" id="form-loading-overlay-calc">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>
    </main>
    <!-- START FAQ SECTION ADDITION -->
    <!-- FAQ Section -->
    <section class="faq-section-container" id="faq-section">
        <div class="faq-section-inner">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-8 text-center">Frequently Asked Questions</h1>

            <!-- FAQ Item 1 -->
            <details class="group faq-item-details">
                <summary class="faq-summary">
                    <span class="faq-question-text">What is the One.Finance Income Tax Calculator?</span>
                </summary>
                <div class="faq-answer-content">
                    <p>Our calculator is a free, interactive tool that helps you estimate your annual income tax liability under both New and Old Regime.</p>
                </div>
            </details>

            <!-- FAQ Item 2 -->
            <details class="group faq-item-details">
                <summary class="faq-summary">
                    <span class="faq-question-text">Who can use this calculator?</span>
                </summary>
                <div class="faq-answer-content">
                    <p>Only individual taxpayers with salary income, rental income or loss, and interest income can use it. If you have business income or capital gains or use marginal relief, please consult a tax professional for those cases.</p>
                </div>
            </details>

            <!-- FAQ Item 3 -->
            <details class="group faq-item-details">
                <summary class="faq-summary">
                    <span class="faq-question-text">Does the calculator factor in surcharge ?</span>
                </summary>
                <div class="faq-answer-content">
                    <p>Yes. Final estimates automatically include applicable surcharge rates. It won't consider Marginal relief.</p>
                </div>
            </details>

            <!-- FAQ Item 4 -->
            <details class="group faq-item-details">
                <summary class="faq-summary">
                    <span class="faq-question-text"> Do I still need a professional to file the return?</span>
                </summary>
                <div class="faq-answer-content">
                    <p>Yes, this calculator is a great planning aid, but for complex filings (audits, business returns, capital‑gains reporting), we recommend professional advice. One.Finance is here to support you at every step!</p>
                </div>
            </details>

            <!-- FAQ Item 5 (Example of adding more) -->
            <details class="group faq-item-details">
                <summary class="faq-summary">
                    <span class="faq-question-text"> Is my data secure, and can I save or download my calculation?</span>
                </summary>
                <div class="faq-answer-content">
                    <p>Yes, your inputs stay entirely on your device (nothing is stored or shared), ensuring full privacy. Once you’ve run the numbers, just click “Download PDF” to save a detailed summary of your estimated tax liability in both regimes.</p>
                </div>
            </details>
        </div>
    </section>
    <!-- END FAQ SECTION ADDITION -->

    <!-- Footer Section -->
    <footer class="footer">
        <div class="container">
            <div class="footer-col">
                <h4>One.Finance</h4>
                <p>Your dedicated CFO Buddy for startups, handling finances end-to-end so you can focus on building your dream.</p>
                <div class="social-links">                    
                    <a href="https://www.linkedin.com/company/onedotfinance/" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                    <a href="https://www.instagram.com/one.finance_?igsh=MTNuemFrdnBkbGhkZg%3D%3D&utm_source=qr" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="footer-col">
                <h4>Quick Links</h4>
                <a href="index.html">Home</a>
                <a href="about.html">About Us</a>                        
                <a href="blog.html">Blog</a>
                <a href="#cta-form">Talk to us</a> <!-- Linked to CTA -->
            </div>
            <div class="footer-col">
                <h4>Our Services</h4>
                <a href="cfo-service.html">Virtual CFO Services</a>
                <a href="income-tax.html">Income Tax Consultation</a>
                <a href="gst-filing.html">GST Filing & Registration</a>
                <a href="other-service.html">Other Service</a>
            </div>
            <div class="footer-col">
                <h4>Tools</h4>
                <a href="income-tax-calculator.html">Income Tax Calculator</a>
                <a href="invoice-generator.html">Invoice Generator</a>
                <a href="rental-agreement-generator.html">Rental Agreement Generator</a>
                <a href="https://chatgpt.com/g/g-687578e125e08191afa13170e0f5d91f-one-finance-ai">One.finance AI</a>                
            </div>
            <div class="footer-col">
                <h4>Contact Us</h4>
                <p>Email: <a href="mailto:vishnu@onedotfinance.com">vishnu@onedotfinance.com</a></p>
                <p>Phone: <a href="tel:+917373772883">+91 7373772883</p>
                <p>Address: RR Tower 3, SIDCO, Guindy, Chennai - 600032</p>
            </div>
        </div>
        <div class="footer-bottom">
            &copy; 2025 One.Finance. All rights reserved.
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables for Firebase config and app ID
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, db, auth;

        // Initialize Firebase and authenticate
        const initializeFirebase = async () => {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase config is empty. Cannot initialize Firebase.");
                    // Fallback for local development if firebaseConfig is not provided
                    return;
                }
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                    console.log("Signed in with custom token for tool page.");
                } else {
                    await signInAnonymously(auth);
                    console.log("Signed in anonymously for tool page.");
                }
            } catch (error) {
                console.error("Error initializing Firebase or signing in on tool page:", error);
                // Display an error message on the page if Firebase fails to initialize
                displayFormMessage("Error initializing services. Please try again later.", "error", 'form-message-calc');
            }
        };

        document.addEventListener('DOMContentLoaded', async () => {
            await initializeFirebase(); // Initialize Firebase as soon as the DOM is ready

            // --- Global Header & Footer JS ---
            const header = document.querySelector('.header');
            const menuToggle = document.querySelector('.menu-toggle');
            const navMenu = document.querySelector('.nav-menu');

            // Sticky header functionality
            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    header.style.padding = '0.6rem 0';
                    header.style.boxShadow = 'var(--shadow-medium)';
                } else {
                    header.style.padding = '0.7rem 0';
                    header.style.boxShadow = 'var(--shadow-light)';
                }
            });

            // Mobile menu toggle
            menuToggle.addEventListener('click', () => {
                navMenu.classList.toggle('active');
                menuToggle.querySelector('i').classList.toggle('fa-bars');
                menuToggle.querySelector('i').classList.toggle('fa-times'); // Change icon to 'X'
            });

            // Close mobile menu when a link is clicked
            navMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    if (navMenu.classList.contains('active')) {
                        navMenu.classList.remove('active');
                        menuToggle.querySelector('i').classList.remove('fa-times');
                        menuToggle.querySelector('i').classList.add('fa-bars');
                    }
                });
            });

            // Smooth scrolling for anchor links (only for current page anchors)
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    // Only smooth scroll if the href is an internal anchor on the same page
                    if (this.pathname === window.location.pathname) {
                        e.preventDefault();
                        document.querySelector(this.getAttribute('href')).scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // --- CTA Form Logic (for calculator page) ---
            const contactFormCalculator = document.getElementById('contact-form-calculator');
            const formMessageCalc = document.getElementById('form-message-calc');
            const formLoadingOverlayCalc = document.getElementById('form-loading-overlay-calc');

            // Function to display form messages (scoped for this form)
            const displayFormMessage = (message, type, targetId = 'form-message-calc') => {
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.textContent = message;
                    targetElement.className = `form-message show ${type}`;
                    setTimeout(() => {
                        targetElement.classList.remove('show');
                    }, 5000); // Message disappears after 5 seconds
                }
            };

            // Function to show/hide loading overlay (scoped for this form)
            const showLoading = (show, targetId = 'form-loading-overlay-calc') => {
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    if (show) {
                        targetElement.classList.add('show');
                    } else {
                        targetElement.classList.remove('show');
                    }
                }
            };

            // Handle contact form submission
            if (contactFormCalculator) {
                contactFormCalculator.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    showLoading(true, 'form-loading-overlay-calc'); // Show loading spinner

                    if (!db || !auth || !auth.currentUser) {
                        displayFormMessage("Service not ready. Please try again in a moment.", "error", 'form-message-calc');
                        showLoading(false, 'form-loading-overlay-calc');
                        return;
                    }

                    const formData = {
                        name: contactFormCalculator.elements['cta-name-calc'].value,
                        email: contactFormCalculator.elements['cta-email-calc'].value,
                        phone: contactFormCalculator.elements['cta-phone-calc'].value,
                        serviceInterest: contactFormCalculator.elements['cta-service-interest-calc'].value,
                        message: contactFormCalculator.elements['cta-message-calc'].value,
                        timestamp: serverTimestamp(), // Firestore server timestamp
                        userId: auth.currentUser.uid // Store the user ID
                    };

                    try {
                        // Store in a 'public' collection under the app ID
                        const docRef = await addDoc(collection(db, `artifacts/${appId}/public/data/contact_submissions`), formData);
                        console.log("Document written with ID: ", docRef.id);
                        displayFormMessage("Your message has been sent successfully! We will get back to you soon.", "success", 'form-message-calc');
                        contactFormCalculator.reset(); // Clear the form
                    } catch (e) {
                        console.error("Error adding document: ", e);
                        displayFormMessage("Failed to send your message. Please try again.", "error", 'form-message-calc');
                    } finally {
                        showLoading(false, 'form-loading-overlay-calc'); // Hide loading spinner
                    }
                });
            }

            // --- Income Tax Calculator Logic ---
            // Add inputmode and pattern for number inputs to optimize mobile keyboard
            document.querySelectorAll('input[type=number]').forEach(i => {
                i.setAttribute('inputmode', 'numeric');
                i.setAttribute('pattern', '\\d*');
                i.setAttribute('step', '1');
                i.addEventListener('input', () => {
                    i.value = i.value.replace(/\D/g, '');
                });
            });

            // References
            const fyI = document.getElementById('fy'),
            ayI = document.getElementById('ay'),
            nameI = document.getElementById('name'),
            ageG = document.getElementById('ageGroup'),
            grossS = document.getElementById('grossSalary'),
            profT = document.getElementById('professionalTax'),
            hraEx = document.getElementById('hraExempt'),
            otherEx = document.getElementById('otherExempt'),
            bPay = document.getElementById('basicPay'),
            hraR = document.getElementById('hraReceived'),
            rentP = document.getElementById('rentPaid'),
            sumG  = document.getElementById('sumGrossSalary'),
            sumEx = document.getElementById('sumTotalExemptions'),
            rentR = document.getElementById('rentReceived'),
            muni  = document.getElementById('municipalTax'),
            intL  = document.getElementById('interestLoan'),
            sumH  = document.getElementById('sumHHP'),
            sInc  = document.getElementById('savingsIncome'),
            fInc  = document.getElementById('fdIncome'),
            dInc  = document.getElementById('dividendIncome'),
            sumO  = document.getElementById('sumOtherIncome'),
            d80C  = document.getElementById('ded80C'),
            d80CCD = document.getElementById('ded80CCD'),
            d80CCD2 = document.getElementById('ded80CCD2'),
            d80G  = document.getElementById('donationPaid'),
            dedTTA  = document.getElementById('ded80TTA'),
            dedTTB  = document.getElementById('ded80TTB'),
            sum6A   = document.getElementById('sumChap6A'),
            pSelf   = document.getElementById('premSelf'),
            pCheck  = document.getElementById('preventiveCheck'),
            pParent = document.getElementById('premParent'),
            mExp    = document.getElementById('medExpend'),
            sum8D   = document.getElementById('sum80D'),
            revBody = document.getElementById('reviewBody'),
            taxBody = document.getElementById('taxBreakdownBody'),
            steps   = document.querySelectorAll('.step-indicator');
            
            const ctaForm = document.getElementById('ctaForm');


            // Helpers
            function formatRS(x){ return 'Rs. '+Number(x).toLocaleString('en-IN'); }
            function resetAll(){ location.reload(); }

            // New function for counting animation
            function animateNumber(element, start, end, duration) {
                let startTime = null;

                function easeOutCubic(t) {
                    return (--t) * t * t + 1;
                }

                function animate(currentTime) {
                    if (!startTime) startTime = currentTime;
                    const progress = Math.min((currentTime - startTime) / duration, 1);
                    const easedProgress = easeOutCubic(progress);
                    const currentValue = start + (end - start) * easedProgress;
                    element.textContent = formatRS(Math.round(currentValue));

                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        element.textContent = formatRS(end); // Ensure final value is exact
                    }
                }
                requestAnimationFrame(animate);
            }

            // Prevent invalid negative input
            document.querySelectorAll('input[type=number]').forEach(i =>
                i.addEventListener('input', () => {
                    if (+i.value < 0) i.value = '';
                })
            );

            // Restrict name input
            nameI.addEventListener('input', e => {
                e.target.value = e.target.value.replace(/[^A-Za-z ]/g, '').slice(0, 30);
                document.getElementById('nameError').innerText = ''; // Clear error on valid input
            });

            // Step1: FY → AY explicit
            function updateAY() {
                if (fyI.value === '2024-2025') ayI.value = '2025-2026';
                else if(fyI.value==='2025-2026') ayI.value='2026-2027';
            }
            fyI.addEventListener('change', updateAY);
            updateAY();

            // Step2 validation & summary
            function validateStep2(){
        const g=+grossS.value||0, p=+profT.value||0, o=+otherEx.value||0;
        const b=+bPay.value||0, h=+hraR.value||0;
        let msg='';
        if(p>30000) msg='Prof Tax ≤ ₹30,000';
        else if(o+b+h+p>g) msg='(Other+Basic+HRA+PTax) ≤ Gross';
        document.getElementById('step2Error').innerText=msg;
        return !msg;
      }
      function updateStep2(){
        const b=+bPay.value||0, h=+hraR.value||0, r=+rentP.value||0;
        const ex=Math.max(0,Math.min(h, r-0.1*b,0.5*b));
        hraEx.value = ex.toFixed(2);
        const totalEx=(+profT.value||0)+(+otherEx.value||0)+ex;
        sumG.innerText=formatRS(+grossS.value||0);
        sumEx.innerText=formatRS(totalEx);
      }
      [grossS,profT,otherEx].forEach(el=>el.addEventListener('input',updateStep2));
      [bPay,hraR,rentP].forEach(el=>el.addEventListener('input',updateStep2));

      // Step3
      function updateHHP(){
        let r=+rentR.value||0,m=+muni.value||0,i=+intL.value||0;
        m=Math.min(m,r);
        const std=r>0?(r-m)*0.3:0;
        let net = r>0? r-m-std-i : -i;
        net=Math.max(net,-200000);
        sumH.innerText=formatRS(Math.round(net));
      }
      [rentR,muni,intL].forEach(el=>el.addEventListener('input',updateHHP));

      // Step4
      function updateOther(){
        const s=+sInc.value||0,f=+fInc.value||0,d=+dInc.value||0;
        sumO.innerText=formatRS(s+f+d);
      }
      [sInc,fInc,dInc].forEach(el=>el.addEventListener('input',updateOther));

      // Step5
      function updateTTA_TTB(){
        const age=ageG.value,s=+sInc.value||0,f=+fInc.value||0;
        dedTTA.innerText=formatRS(age==='below60'?Math.min(s,10000):0);
        dedTTB.innerText=formatRS(age==='above60'?Math.min(s+f,50000):0);
      }
      [ageG,sInc,fInc].forEach(el=>el.addEventListener('input',updateTTA_TTB));

      function update6A(){
        let c1=+d80C.value||0,c2=+d80CCD.value||0,c22=+d80CCD2.value||0,gEx=+otherEx.value||0;
        c1=Math.min(c1,150000);
        c2=Math.min(c2,200000-c1);
        const base = (+bPay.value>0?+bPay.value:+grossS.value-gEx);
        let cap2 = Math.min(c22, base* 0.10);
        const g = c1+c2+cap2+(+d80G.value||0)*0.5
                +(+dedTTA.textContent.replace(/[^0-9]/g,''))
                +(+dedTTB.textContent.replace(/[^0-9]/g,''));
        sum6A.innerText=formatRS(Math.round(g));
      }
      [d80C,d80CCD,d80CCD2,d80G].forEach(el=>el.addEventListener('input',update6A));

      // Step6
      function update8D(){
        let s = +pSelf.value || 0;
        let pc = +pCheck.value || 0;
        const maxPrem = ageG.value === 'below60' ? 25000 : 50000;
        // Premium Self capped at maxPrem, Preventive capped at 5k
        s = Math.min(s, maxPrem);
        pc = Math.min(pc, 5000);
        // Combined must not exceed maxPrem
        if (s + pc > maxPrem) pc = maxPrem - s;
       
        let par = +pParent.value || 0;
        let m = +mExp.value || 0;
        par = Math.min(par, 50000);
        m = Math.min(m, 50000);
        if (par + m > 50000) m = 50000 - par;

        sum8D.innerText = formatRS(Math.round(s + pc + par + m));
          }
      [pSelf,pCheck,pParent,mExp].forEach(el=>el.addEventListener('input',update8D));


            // Navigation & final render
            function showStep(id) {
                document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
                document.getElementById(id).classList.add('active');

                // Update progress bar
                steps.forEach(si => {
                    const stepNum = parseInt(si.dataset.step);
                    const currentStepNum = parseInt(id.replace('step', ''));
                    si.classList.toggle('active', stepNum === currentStepNum);
                    si.classList.toggle('completed', stepNum < currentStepNum);
                });
            }

            document.querySelectorAll('.next-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const currentStepId = btn.closest('.step').id;
                    if (currentStepId === 'step1' && !nameI.value.trim()) {
                        document.getElementById('nameError').innerText = 'Name is required.';
                        nameI.focus();
                        return;
                    }
                    if (currentStepId === 'step2' && !validateStep2()) {
                        grossS.focus(); // Focus on gross salary if there's an error
                        return;
                    }
                    showStep(btn.dataset.next);
                    if (btn.dataset.next === 'step3') updateHHP();
                    if (btn.dataset.next === 'step4') updateOther();
                    if (btn.dataset.next === 'step5') {
                        updateTTA_TTB();
                        update6A();
                    }
                    if (btn.dataset.next === 'step6') update8D();
                    if (btn.dataset.next === 'step7') renderReview();
                });
            });

            document.querySelectorAll('.prev-btn').forEach(btn =>
                btn.addEventListener('click', () => showStep(btn.dataset.prev))
            );

            // Tax calculators
            function computeTaxOld(income, age){
        let tax=0;
        if(age==='below60'){
          if(income>1000000) tax=112500+(income-1000000)*.30;
          else if(income>500000) tax=12500+(income-500000)*.20;
          else if(income>250000) tax=(income-250000)*.05;
        } else {
          if(income>1000000) tax=110000+(income-1000000)*.30;
          else if(income>500000) tax=10000+(income-500000)*.20;
          else if(income>300000) tax=(income-300000)*.05;
        }
        let sRate=0;
        if(income>50000000) sRate=.37;
        else if(income>20000000) sRate=.25;
        else if(income>10000000) sRate=.15;
        else if(income>5000000) sRate=.10;
        const sur=tax*sRate;
        const reb=income<=(age==='below60'?500000:300000)?tax:0;
        const base=tax+sur-reb, cess=base*.04;
        return {basicTax:Math.round(tax),surcharge:Math.round(sur),rebate:Math.round(reb),cess: Math.round(cess),totalTax:Math.round(base+cess)};
      }
      function computeTaxNew(income){
        let tax=0, fy=fyI.value;
        if(fy==='2025-2026'){
          if(income>2400000)    tax=300000+(income-2400000)*.30;
          else if(income>2000000) tax=200000+(income-2000000)*.25;
          else if(income>1600000) tax=120000+(income-1600000)*.20;
          else if(income>1200000) tax=60000+(income-1200000)*.15;
          else if(income>800000)  tax=20000+(income-800000)*.10;
          else if(income>400000)  tax=(income-400000)*.05;
          else                    tax=0;
          var reb = income<=1200000?tax:0;
        } else {
          if(income>1500000)      tax=140000+(income-1500000)*.30;
          else if(income>1200000) tax=80000+(income-1200000)*.20;
          else if(income>1000000) tax=50000+(income-1000000)*.15;
          else if(income>700000)  tax=20000+(income-700000)*.10;
          else if(income>300000)  tax=(income-300000)*.05;
          else                    tax=0;
          var reb = income<=700000?tax:0;
        }
        let sRate=0;
        if(income>20000000) sRate=.25;
        else if(income>10000000) sRate=.15;
        else if(income>5000000) sRate=.10;
        const sur=tax*sRate, base=tax+sur-reb, cess=base*.04;
        return {basicTax:Math.round(tax),surcharge:Math.round(sur),rebate:Math.round(reb),cess:Math.round(cess),totalTax:Math.round(base+cess)};
      }


            // Render final review
            function renderReview(){
        document.getElementById('reviewName').textContent = nameI.value||'—';
        document.getElementById('reviewAge').textContent = ageG.selectedOptions[0].text;
        document.getElementById('reviewFY').textContent = fyI.value;
        document.getElementById('reviewAY').textContent = ayI.value;

        const salary = +grossS.value||0;
        const exOld = (+profT.value||0) + (+hraEx.value||0) + (+otherEx.value||0);
        const exNew = 0;
        const stdOld = Math.min(50000, (salary - exOld)), stdNew = Math.min(75000, (salary - exNew));
       
        const netOld = salary - exOld -stdOld, netNew = salary - exNew -stdNew;

        let hhpRaw = (+rentR.value? (+rentR.value-Math.min(+muni.value||0,+rentR.value))*0.7 - (+intL.value||0) : -(+intL.value||0));
        const hhpOld = Math.max(hhpRaw,-200000), hhpNew = Math.max(hhpRaw,0);
        let others = (+sInc.value||0) + (+fInc.value||0) + (+dInc.value||0);

        let hhpAdj = hhpOld;
        if(netOld+hhpOld+others < 0) hhpAdj = -(netOld+others);

        const grossOld = netOld+hhpAdj+others;
        const grossNew = Math.max(0, netNew+hhpNew+others);


        const total6Old = Number(sum6A.textContent.replace(/[^0-9]/g,''))||0;
        let gEx=+otherEx.value||0;
        const base = (+bPay.value>0?+bPay.value:Math.max(0,salary-gEx));
        const maxCcd2 = base*0.14;
        let userCcd2 = +d80CCD2.value||0;
        if(userCcd2>maxCcd2){
          alert(`80CCD2 capped to ₹${maxCcd2.toFixed(2)} (14% of base).`);
          userCcd2 = maxCcd2;
        }
        const total6New = userCcd2;

        const total8Old = Number(sum8D.textContent.replace(/[^0-9]/g,''))||0;
        const total8New = 0;

        const taxOldInc = Math.max(0, grossOld - total6Old - total8Old);
        const taxNewInc = Math.max(0, grossNew - total6New - total8New);

        const rows = [
          ['Gross Salary', salary, salary],
          ['Total Exemptions', exOld, exNew],
          ['Standard Deduction', -stdOld, -stdNew],
          ['Net Salary', netOld, netNew],
          ['House Property', hhpAdj, hhpNew],
          ['Other Sources', others, others],
          ['Gross Total Income', grossOld, grossNew],
          ['Total Deductions', total6Old+total8Old, total6New+total8New],
          ['Taxable Income', taxOldInc, taxNewInc]
        ];
        revBody.innerHTML = '';
        rows.forEach(([lbl,ov,nv])=>{
          const tr = document.createElement('tr');
          if(lbl==='Taxable Income') tr.classList.add('bold-row');
          [lbl, formatRS(ov), formatRS(nv)].forEach(txt=>{
            const td = document.createElement('td');
            td.innerText = txt;
            tr.appendChild(td);
          });
          revBody.appendChild(tr);
        });

        const oldT = computeTaxOld(taxOldInc, ageG.value);
        const newT = computeTaxNew(taxNewInc);
        const brk = [
          ['Basic Tax', oldT.basicTax, newT.basicTax],
          ['Surcharge', oldT.surcharge, newT.surcharge],
          ['Rebate', oldT.rebate, newT.rebate],
          ['Cess (4%)', oldT.cess, newT.cess],
          ['Total Tax Payable', oldT.totalTax, newT.totalTax]
        ];
        taxBody.innerHTML = '';
        brk.forEach(([lbl,ov,nv])=>{
          const tr = document.createElement('tr');
          if(lbl==='Total Tax Payable') tr.classList.add('bold-row');
          [lbl, formatRS(ov), formatRS(nv)].forEach(txt=>{
            const td = document.createElement('td');
            td.innerText = txt;
            tr.appendChild(td);
          });
          taxBody.appendChild(tr);
        });
      }

            // Guideline functionality
            const allInputsAndSelects = document.querySelectorAll('.fields input, .fields select, .fields strong'); // Include strong elements for fields that display calculated values with guidelines
            allInputsAndSelects.forEach(input => {
                const parentDiv = input.closest('.field-container');
                if (!parentDiv) return; // Skip if not inside a field-container

                const guidelineDiv = parentDiv.querySelector('.guideline');
                const guidelineText = input.dataset.guideline;

                if (guidelineDiv && guidelineText) {
                    guidelineDiv.textContent = guidelineText;

                    input.addEventListener('focus', () => {
                        guidelineDiv.classList.add('active');
                    });

                    input.addEventListener('blur', () => {
                        guidelineDiv.classList.remove('active');
                    });
                }
            });

            // Intersection Observer for CTA animation
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-in');
                        // Optionally, stop observing once it's animated
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                root: null, // relative to the viewport
                rootMargin: '0px',
                threshold: 0.1 // Trigger when 10% of the item is visible
            });

            // Observe the CTA form
            observer.observe(ctaForm);


            // Initialize
            window.resetAll = resetAll;
            window.renderReview = renderReview;
            showStep('step1');
            // Add click listener for step indicators to navigate
            steps.forEach(si => si.addEventListener('click', () => {
                const stepNum = parseInt(si.dataset.step);
                showStep(`step${stepNum}`);
                if (stepNum === 7) { // If step 7 is clicked
                    renderReview(); // Automatically compute and display results
                }
            }));

            // Initial calculations for relevant steps on page load (if fields have default values)
            updateStep2();
            updateHHP();
            updateOther();
            updateTTA_TTB();
            update6A();
            update8D();
        });
    </script>
</body>
</html>
